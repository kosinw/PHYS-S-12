---
layout: post
title:  "Final Project"
permalink: /12/
---

# Portable Drum Kit (CIMBAL)
After realizing the issues of creating a smartwatch that requires small electronics, I concluded that constructing a quality final project was infeasible in the remaining time left of the course.

I have concluded on starting a new project: a portable drum kit. This drum kit will allow users to use socks and gloves to control each component of a drum kit. Through the MIDI protocol, an [Adafruit Circuit Playground](#12a) will communicate with the [Hydrogen Drums software](http://hydrogen-music.org/) which reads MIDI input and translates it to percussive instruments.

After using a [machine-learning AI to generate product/brand based on keywords](https://namelix.com/#), I have aptly named this project CIMBAL.

### Initial BOM
Electronic components needed include three or four [Arduino Nano boards](https://www.arduino.cc/en/Guide/ArduinoNano), one [Adafruit Circuit Playground](https://www.adafruit.com/index.php?main_page=category&cPath=888), two times the amount of RF24/radio modules than Arduino Nano's boards, and six or ten piezoelectric sensors or capacitive touch sensors (whichever ones work better). Conductive thread and wires are also needed to connect circuitry. An I2C OLED display for stats on MIDI devices. A USB micro-B connector to connect the Circuit Playground as a MIDI device and mini USB to program each Arduino Nano board.

### Diagrams
[Figure 12B](#12b) outlines the transmitter circuits for the socks and the glove(s). The sock diagram shows that a piezoelectric sensor / capacitive touch sensor on the bottom of the sock which will be read by an Arduino Nano or microcontroller and transmit data to the receiever circuit using an RF24 circuit. The RF24, sensor, 3.3V coin cell, and micrcontroller will all be sewn onto the sock and connected through conductive thread. The glove diagram shows something similar to the sock diagram, however; it uses multiple piezos / capacitive touch sensors which each correlate to a specific drum. [Figure 12C](#12c) outlines the receiver circuit for the [Circuit Playground](#12a) and its enclosure to the laptop. The circuit will contain a potentiometer to be used for volume control, an OLED display to display information on the volume and instrument used currently, and an RF24 receiver module. The circuit will fit in a box CNC milled enclosure (or 3D printed) created from some sort of wood hopefully.

### Circuits
[Figure 12D](#12d) outlines the transmitter circuits and the receiver circuits.

### Inspiration
- [Fruit Drums](https://learn.adafruit.com/circuit-playground-fruit-drums/overview): A project that uses the Circuit Playground to transform fruits into MIDI drums.

<figure id="12a">
    <img src="./circuit_play.jpg">
    <p><a href="#12a">Figure 12A</a>: <a href="https://www.adafruit.com/index.php?main_page=category&cPath=888">Adafruit Circuit Playground.</a> A development board that uses the ATMega32u4 and is designed for beginner programmers to use. The <a href="./circuit_playground.stl" download>STL file can be downloaded</a> and imported to be used in CAD software.</p>
</figure>

<figure id="12b">
    <img src="./diagrams.jpg">
    <p><a href="#12b">Figure 12B</a>: Trasmitter diagrams. Capactive touch sensors (or piezoelectric ones) correspond to the different percussion instruments found in a drum kit.</p>
</figure>

<figure id="12c">
    <img src="./enclosure.jpg">
    <p><a href="#12c">Figure 12C</a>: Receiver diagrams. A digitally fabricated enclosure which acts as a receiver for multiple transmitters to convert signals to MIDI.</p>
</figure>

<figure id="12d">
    <img src="./schematics.jpg">
    <p><a href="#12d">Figure 12D</a>: Transmitter and receiever circuits. Electrical schematic which shows how the piezoelectric / capacitive sensors interact with uCs and communicate with the receiever using an RF24 module.</p>
</figure>

## Update (2019, July 29)

### Microcontrollers
During the Tuesday section, Rob introduced two new Arduino development boards that use a different microcontroller than the ATMega328P (which is found in the Arduino Uno, Pro Mini, and Nano). These two boards are the [Arduino Micro](#12e) and [Arduino Pro Micro](#12f) and both use the [ATMega32u4](https://www.microchip.com/wwwproducts/en/ATmega32U4). The main functional difference for using the ATMega32u4 over the ATMega328p is the fact that the 32u4 has built-in USB support. This allows for (meaningful) difference in my project and the [Micro](#12e) can be used as a USB MIDI device. In addition, I am dropping the use of the Adafruit Circuit Playground due to difficulty as using as a prototype and lack of pins.

<figure id="12e">
    <img src="./arduino_micro.jpg">
    <p><a href="#12e">Figure 12E</a>: Arduino Micro R3. Driven by an ATMega32u4 micocontroller is programmed via USB mini-B.</p>
</figure>

<figure id="12f">
    <img src="./pro_micro.jpg">
    <p><a href="#12f">Figure 12F</a>: Arduino Pro Micro. Driven by an ATMega32u4 micontroller, programmed via USB mini-B, and is of smaller form factor than the Arduino Nano.</p>
</figure>

### Sensors
After some pondering, I realized that both the piezoelectric sensors and capacitive touch sensors may not work most efficiently for wearable electronics projects. The piezoelectric sensors are very fragile so they are prone to breaking easily plus the piezos found in the lab are too large to fit on the pad of a finger. Capactiive touch sensors are very unreliable (without an external module like the Adafruit MPR121) and the static generated from fabric will interfere with the capacitance of the sensor. Thankfully, pioneers in the weararble electronics market have invented [velostat](https://en.wikipedia.org/wiki/Velostat), a fabric that is electrically conductive and can be used as a (relatively) inexprensive pressure sensor for shoes. [This](https://learn.adafruit.com/firewalker-led-sneakers/make-velostat-step-sensors) Adafruit project shows an example of how velostat can be used to detect pressure. [Here](#12g) are the revisions to all of the diagrams to account for the new modifications.

<figure id="12g">
    <!-- <img src="./pro_micro.jpg"> -->
    <p><a href="#12g">Figure 12G</a>: Revisions for schematics and diagrams. Modified to include velostat sensors and 32u4 boards.</p>
</figure>

### Radios
In today's [section]({{ "/09#2019-july-29-monday-lab" | prepend : site.baseurl }}), I was able to get an 328P transmitter to communicate with a 32u4 receiver; therefore, future progress must be made where I implement some sort of [OSI, packet-based communication protocol like TCP](https://en.wikipedia.org/wiki/Transmission_Control_Protocol) where one 32u4 receiver can communicate with multiple 32u4 transmitters. This can be implemented using the [RF24Network](https://github.com/nRF24/RF24Network) library hopefully.

### Modelling
Today, I modelled a rudimentary version of the [RX diagram](#12h) without any text and fancy featuers. So far it lacks snap fitting (which I plan to implement by the end of Wednesday's Lab), text features, and some sort of power switch. The case itself is quite rudimentary, only being a knob with a circular extrusion (not able to design a knob that fits a potentiometer exactly). Hopefully I will be able to 3D print each part of the model and get a working receiver diagram by the end of Wedensday's Lab (i.e., 2019, July 31).

<figure id="12g">
    <img src="./rxv1.png">
    <p><a href="#12g">Figure 12G</a>: Rudimentary model for the RX circuit. <a download href="./CIMBAL RX v8.stl">The STL file is downloadable here.</a></p>
</figure>